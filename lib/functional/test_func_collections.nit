# This file is part of NIT ( http://www.nitlanguage.org ).
#
# Copyright 2019 Louis-Vincent Boudreault <lv.boudreault95@gmail.com>
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# This file is automatically generated.
module test_func_collections is test

import func_collections

class AddOneRef
        super Proc1[Ref[Int]]
        redef fun call(x)
        do
                x.item += 1
        end
end


fun add_one_ref: AddOneRef
do
        return new AddOneRef
end

# test cases for `Entry` API
class TestHashMap
        test

        fun must_be_vacant is test do
                var map = new HashMap[Int,Int]
                var entry = map.entry(1)
                assert entry isa Vacant[Int,Int]
        end


        fun must_be_occupied is test do
                var map = new HashMap[Int,String]
                map[1] = "one"
                var entry = map.entry(1)
                assert entry isa Occupied[Int,String]
        end


        fun add_one_to_occupied_entry is test do
                var map = new HashMap[Int,Ref[Int]]
                map[1] = new Ref[Int](1)
                var entry = map.entry(1)
                entry.and_do(add_one_ref)
                assert map[1].item == 2
        end


        fun add_one_to_vacant_entry is test do
                var map = new HashMap[Int,Ref[Int]]
                var entry = map.entry(1)
                entry.and_do(add_one_ref)
                assert not map.has_key(1)
        end


        fun insert_ten_if_vacant is test do
                var map = new HashMap[Int,Ref[Int]]
                var entry = map.entry(1)
                entry.or_insert(new Ref[Int](10))
                assert map[1].item == 10
        end

        fun do_nothing_if_occupied is test do
                var map = new HashMap[Int,Ref[Int]]
                map[1] = new Ref[Int](1)
                var entry = map.entry(1)
                entry.or_insert(new Ref[Int](10))
                assert map[1].item == 1
        end
end
